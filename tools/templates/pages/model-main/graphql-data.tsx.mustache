// Generated backend code
// The exported default function is intended to be
// imported as getServerSideProps in a pages/**/*.jsx file
//
// This file needs to be in a separate file from the UI React
// component, or nextjs build will fail.
import { getPageConfig } from "~/static/page-config";
import { gql } from "@apollo/client";
import { ApolloClient, InMemoryCache } from "@apollo/client";

export default async function getServerSideProps(context: any) {
  const pageConfigProps = getPageConfig(context);
  const uri = "{{{ uri }}}";
  const query = gql`{{{ query }}}`;
  const variables = {{{ variables }}};
  const {data} = await graphqlFetch(uri)(query)(variables);

  return {
    props: {
      ...pageConfigProps.props,
      data,
    },
  };
}

// graphqlFetch :: uri -> query -> params -> Promise<any>
const graphqlFetch = (uri: string) => {
  const apolloClient = new ApolloClient({
    uri,
    cache: new InMemoryCache(),
    ssrMode: true,
  });

  return (query:any) => (variables:any) => apolloClient.query({query, variables});
}